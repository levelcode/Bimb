$(function(){function n(){var n=new Image;n.src=d[l],n.onload=function(){var o=g.getCenter();g.setOverlayImage(d[l],g.renderAll.bind(g),{crossOrigin:"anonymous",top:30,left:o.left,originX:"center",originY:"top"}),n={}},l++,4==l&&(l=0)}function o(n){n=parseFloat(c(n,2)),n>window.scaleImageInit&&(window.scaleImage=window.scaleImageInit),n<0&&(window.scaleImage=0);var o=g.getCenter();window.instanceImg.set({scaleY:n,scaleX:n,left:o.left,top:o.top,originX:"center",originY:"center"}),g.renderAll(),g.calcOffset()}function e(n){for(var o=atob(n.split(",")[1]),e=new ArrayBuffer(o.length),t=new Uint8Array(e),i=0;i<o.length;i++)t[i]=o.charCodeAt(i);return new Blob([e],{type:"image/png"})}function t(){$(".canvas").height($(".canvas").width())}function i(n){var o=Math.floor($(".canvas").width()),e="https://graph.facebook.com/"+n+"/picture?width="+o+"&height="+o;$("#img-load")[0].crossOrigin="Anonymous",$("#img-load")[0].crossorigin="anonymous",$("#img-load").attr("src",e),$("#img-load").on("load",function(n){s()})}function a(){var n=["iPad Simulator","iPhone Simulator","iPod Simulator","Safari","iPad","iPhone","iPod"];if(navigator.platform)for(;n.length;)if(navigator.platform===n.pop())return!0;var o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return!!o}function s(){"undefined"!=typeof window.instanceImg&&g.remove(window.instanceImg);var n=document.getElementById("img-load"),o={tl:!1,tr:!1,bl:!1,br:!1,ml:!1,mt:!1,mr:!1,mb:!1,mtr:!0};if(a())fabric.util.loadImage(n.src,function(n){var e=Math.floor($(".canvas").width()),t=n.width,i=e/t,a=e,s=e;$(window).width()<768?(window.cornerSize=28,i=543/t,s=543,a=543):window.cornerSize=14;var r=0,c=n.width,l=n.height,e=543,d=543;c>=a&&(r=a/c,d=l*r,e=a),l>=s&&(r=s/l,d=s,e=c*r);var f=new fabric.Image(n);f.set({left:0,top:0,angle:0,opacity:1,cornerSize:window.cornerSize,borderColor:"rgba(2, 0, 61, 0.95)",cornerColor:"rgba(2, 0, 61, 0.95)",transparentCorners:!1,crossOrigin:"Anonymous",width:e,height:d}),window.instanceImg=f,f.setControlsVisibility(o),g.add(f).setActiveObject(f),g.moveTo(f,-1),window.scaleImage=i,window.scaleImageInit=i,$(".canvas").addClass("active")},null,{crossOrigin:"anonymous"});else{var e=Math.floor($(".canvas").width()),t=$(n).width(),i=e/t;$(window).width()<768?(window.cornerSize=28,i=543/t):window.cornerSize=14;var s=new fabric.Image(n,{left:0,top:0,angle:0,opacity:1,cornerSize:window.cornerSize,borderColor:"rgba(2, 0, 61, 0.95)",cornerColor:"rgba(2, 0, 61, 0.95)",transparentCorners:!1,crossOrigin:"Anonymous",scaleX:i,scaleY:i});window.instanceImg=s,s.setControlsVisibility(o),g.add(s).setActiveObject(s),g.moveTo(s,-1),window.scaleImage=i,window.scaleImageInit=i,$(".canvas").addClass("active")}}function r(n,o){if(n.files&&n.files[0]){var e=new FileReader;e.onload=function(n){o.attr("src",n.target.result),s()},e.readAsDataURL(n.files[0])}}function c(n,o){o||(o=2);var e=Math.pow(10,o);return(parseInt(n*e)/e).toFixed(o)}var l=0;window.scaleImage=1;var d=["/assets/texts/f1.png","/assets/texts/f2.png","/assets/texts/f3.png","/assets/texts/f4.png"];window.fbAsyncInit=function(){FB.init({appId:"316155298796722",xfbml:!0,version:"v2.9",status:!0}),FB.AppEvents.logPageView(),FB.getLoginStatus(function(n){"connected"==n.status&&i(n.authResponse.userID)},!0)},function(n,o,e){var t,i=n.getElementsByTagName(o)[0];n.getElementById(e)||(t=n.createElement(o),t.id=e,t.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(t,i))}(document,"script","facebook-jssdk"),$(".btnc.profile-photo button").on("click",function(n){FB.login(function(n){n.authResponse&&FB.api("/me",function(n){i(n.id)})},{scope:"publish_actions"})}),$(".fb-btn.publish button, .donwload button, .fb-btn.share button").on("click",function(n){if("undefined"==typeof window.instanceImg)return void swal("Please choose a photo");var o=($(".canvas").width(),FB.getAccessToken(),window.intanceCanvas.toDataURL("image/jpeg",.98)),t=$(this);blob=e(o);var i=new FormData;i.append("foto",blob),swal({title:"Loading...",showCancelButton:!1,showConfirmButton:!1,showCloseButton:!1}),$.ajax({url:"services/upload_photo.php",type:"POST",data:i,processData:!1,contentType:!1}).done(function(n){var o=window.location.origin+"/"+n;console.log(o),t.parent().hasClass("donwload")?($("#download_link").attr("src","services/donwload.php?url="+o),swal.close()):t.parent().hasClass("share")?(swal.close(),FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":"https://riseandshine.ga","og:title":"Bimbo","og:description":"Rise and Shine","og:og:image:width":543,"og:image:height":543,"og:image":o}})},function(n){console.log(n)})):FB.getLoginStatus(function(n){"connected"==n.status?FB.api("/photos","post",{url:o},function(n){if(console.log(n),"undefined"==typeof n.error)swal({title:"Congratulations",text:" Your photo has been published",type:"success",confirmButtonColor:"#fb8f22"});else{var o="";o=n.error.message.split("(#200)").length>0?"Please allow the permissions app":"Information",swal({title:"Information",text:o,type:"info",confirmButtonColor:"#fb8f22"}),$(".btnc.profile-photo button").trigger("click")}}):(swal.close(),$(".btnc.profile-photo button").trigger("click"))},!0)})}),$(".btnc input.file").on("change",function(n){if("undefined"!=typeof this.files[0]){this.files[0];r(this,$(this).siblings("img"))}}),$(".btnc input.file").hover(function(){$(this).next().addClass("hover")},function(){$(this).next().removeClass("hover")}),$(window).on("resize",function(n){t()}),t();var g=new fabric.Canvas("canvas",{preserveObjectStacking:!0,selection:!1,centeredScaling:!0,allowTouchScrolling:!0});window.intanceCanvas=g,$(".canvas").on("touchstart touchmove touchend",function(n){n.preventDefault()}),fabric.Image.fromURL("/assets/background-canvas.png",function(n){g.add(n)},{left:0,top:0,angle:0,opacity:1,lockMovementX:!0,lockMovementY:!0,hasBorders:!1,hasControls:!1,evented:!1,crossOrigin:"anonymous"},{crossOrigin:"Anonymous"}),$(".btnc.change-msj button").on("click",function(o){n()}),$(".photo .btns .less span").on("click touchend",function(n){window.scaleImage-=.1,o(window.scaleImage)}),$(".photo .btns .plus span").on("click touchend",function(n){window.scaleImage+=.1,o(window.scaleImage)}),n(),a()&&($(".donwload").hide(),$(".fb-btn").css("margin-bottom","118px"))});