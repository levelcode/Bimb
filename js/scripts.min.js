$(function(){function e(){var e=new Image;e.src=r[s],e.onload=function(){var n=e.width,t=(($(".canvas").width()-n)/2,c.getCenter());c.setOverlayImage(r[s],c.renderAll.bind(c),{top:30,left:t.left,originX:"center",originY:"top"}),e={}},s++,4==s&&(s=0)}function n(e){for(var n=atob(e.split(",")[1]),t=new ArrayBuffer(n.length),o=new Uint8Array(t),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return new Blob([t],{type:"image/png"})}function t(){$(".canvas").height($(".canvas").width())}function o(e){var n=$(".canvas").width(),t="http://graph.facebook.com/"+e+"/picture?width="+n+"&height="+n;$("#img-load").attr("src",t),$("#img-load")[0].crossOrigin="Anonymous",$("#img-load").on("load",function(e){i()})}function i(){setTimeout(function(){"undefined"!=typeof window.instanceImg&&c.remove(window.instanceImg);var e=document.getElementById("img-load"),n=new fabric.Image(e,{left:0,top:0,angle:0,opacity:1,borderColor:"rgba(2, 0, 100, 0.9)",cornerColor:"rgba(2, 0, 100, 0.9)",transparentCorners:!1});window.instanceImg=n,c.add(n).setActiveObject(n),c.moveTo(n,-9999)},100)}function a(e,n){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){n.attr("src",e.target.result),n[0].crossOrigin="Anonymous",i()},t.readAsDataURL(e.files[0])}}var s=0,r=["../assets/texts/f1.png","../assets/texts/f2.png","../assets/texts/f3.png","../assets/texts/f4.png"];window.fbAsyncInit=function(){FB.init({appId:"274662929667884",xfbml:!0,version:"v2.9"}),FB.AppEvents.logPageView(),FB.getLoginStatus(function(e){"connected"==e.status&&o(e.authResponse.userID)})},function(e,n,t){var o,i=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk"),$(".btnc.profile-photo button").on("click",function(e){FB.login(function(e){e.authResponse&&FB.api("/me",function(e){o(e.id)})},{scope:"publish_actions"})}),$(".fb-btn.share button").on("click",function(e){FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":"https://riseandshine.ga","og:title":"Bimbo","og:description":"Rise and Shine","og:og:image:width":543,"og:image:height":543,"og:image":"https://riseandshine.ga/assets/logo.png"}})},function(e){console.log(e)})}),$(".fb-btn.publish button, .donwload button").on("click",function(e){var t=($(".canvas").width(),FB.getAccessToken(),c.toDataURL("image/jpeg",.98)),o=$(this),i=new Image;i.src=t,i.crossOrigin="Anonymous",i.onload=function(){var e=document.createElement("canvas"),t=543,a=t;e.width=t,e.height=a;var s=e.getContext("2d");s.drawImage(i,0,0,t,a);var r=e.toDataURL("image/jpeg",.98);blob=n(r);var c=new FormData;c.append("foto",blob),$.ajax({url:"services/upload_photo.php",type:"POST",data:c,processData:!1,contentType:!1}).done(function(e){var n=window.location.origin+"/"+e;o.hasClass("donwload")?window.open("services/download.php?url="+n,"_blank"):FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":"https://riseandshine.ga","og:title":"test","og:description":"test2","og:og:image:width":t,"og:image:height":t,"og:image":n}})},function(e){console.log(e)})})}}),$(".btnc input.file").on("change",function(e){if("undefined"!=typeof this.files[0]){this.files[0];a(this,$(this).siblings("img"))}}),$(".btnc input.file").hover(function(){$(this).next().addClass("hover")},function(){$(this).next().removeClass("hover")}),$(window).on("resize",function(e){t()}),t();var c=new fabric.Canvas("canvas",{preserveObjectStacking:!0,selection:!1});fabric.Image.fromURL("../assets/background-canvas.png",function(e){c.add(e),c.moveTo(e,9999)},{left:0,top:0,angle:0,opacity:1,lockMovementX:!0,lockMovementY:!0,hasBorders:!1,hasControls:!1,evented:!1}),$(".btnc.change-msj button").on("click",function(n){e()}),e()});