$(function(){function n(){var n=new Image;n.src=r[a],n.onload=function(){var o=n.width,t=(($(".canvas").width()-o)/2,c.getCenter());c.setOverlayImage(r[a],c.renderAll.bind(c),{crossOrigin:"anonymous",top:30,left:t.left,originX:"center",originY:"top"}),n={}},a++,4==a&&(a=0)}function o(n){for(var o=atob(n.split(",")[1]),t=new ArrayBuffer(o.length),e=new Uint8Array(t),i=0;i<o.length;i++)e[i]=o.charCodeAt(i);return new Blob([t],{type:"image/png"})}function t(){$(".canvas").height($(".canvas").width())}function e(n){var o=Math.floor($(".canvas").width()),t="https://graph.facebook.com/"+n+"/picture?width="+o+"&height="+o;$("#img-load").attr("src",t),$("#img-load")[0].crossOrigin="Anonymous",$("#img-load")[0].crossorigin="anonymous",$("#img-load")[0].setAttribute("crossOrigin","Anonymous"),$("#img-load").on("load",function(n){i()})}function i(){setTimeout(function(){var n=(Math.floor($(".canvas").width()),.75);$().width()<768&&(n=1.7),"undefined"!=typeof window.instanceImg&&c.remove(window.instanceImg);var o=document.getElementById("img-load"),t=new fabric.Image(o,{left:0,top:0,angle:0,opacity:1,borderColor:"rgba(2, 0, 100, 0.9)",cornerColor:"rgba(2, 0, 100, 0.9)",transparentCorners:!1,crossOrigin:"Anonymous",scaleX:n,scaleY:n});window.instanceImg=t,c.add(t).setActiveObject(t),c.moveTo(t,-9999)},100)}function s(n,o){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){o.attr("src",n.target.result),o[0].crossOrigin="Anonymous",o[0].crossorigin="anonymous",o[0].setAttribute("crossOrigin","Anonymous"),i()},t.readAsDataURL(n.files[0])}}var a=0,r=["/assets/texts/f1.png","/assets/texts/f2.png","/assets/texts/f3.png","/assets/texts/f4.png"];window.fbAsyncInit=function(){FB.init({appId:"274662929667884",xfbml:!0,version:"v2.9",status:!0}),FB.AppEvents.logPageView(),FB.getLoginStatus(function(n){"connected"==n.status&&e(n.authResponse.userID)},!0)},function(n,o,t){var e,i=n.getElementsByTagName(o)[0];n.getElementById(t)||(e=n.createElement(o),e.id=t,e.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(e,i))}(document,"script","facebook-jssdk"),$(".btnc.profile-photo button").on("click",function(n){FB.login(function(n){n.authResponse&&FB.api("/me",function(n){e(n.id)})},{scope:"publish_actions"})}),$(".fb-btn.publish button, .donwload button, .fb-btn.share button").on("click",function(n){var t=($(".canvas").width(),FB.getAccessToken(),c.toDataURL("image/jpeg",.98)),e=$(this),i=new Image;i.src=t,i.crossOrigin="Anonymous",i.crossorigin="anonymous",i.setAttribute("crossOrigin","Anonymous"),i.onload=function(){var n=document.createElement("canvas"),t=543,s=t;n.width=t,n.height=s;var a=n.getContext("2d");a.drawImage(i,0,0,t,s);var r=n.toDataURL("image/jpeg",.98);blob=o(r);var c=new FormData;c.append("foto",blob),swal({title:"Loading...",showCancelButton:!1,showConfirmButton:!1,showCloseButton:!1}),$.ajax({url:"services/upload_photo.php",type:"POST",data:c,processData:!1,contentType:!1}).done(function(n){var o=window.location.origin+"/"+n;console.log(o),e.parent().hasClass("donwload")?($("#download_link").attr("href","services/donwload.php?url="+o).trigger("click"),swal.close()):e.parent().hasClass("share")?(swal.close(),FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":"https://riseandshine.ga","og:title":"Bimbo","og:description":"Rise and Shine","og:og:image:width":543,"og:image:height":543,"og:image":o}})},function(n){console.log(n)})):FB.getLoginStatus(function(n){"connected"==n.status?FB.api("/photos","post",{url:o},function(n){if(console.log(n),"undefined"==typeof n.error)swal({title:"Congratulations",text:" Your photo has been published",type:"success",confirmButtonColor:"#fb8f22"});else{var o="";o=n.error.message.split("(#200)").length>0?"Please allow the permissions app":"Information",swal({title:"Information",text:o,type:"info",confirmButtonColor:"#fb8f22"}),$(".btnc.profile-photo button").trigger("click")}}):(swal.close(),$(".btnc.profile-photo button").trigger("click"))},!0)})}}),$(".btnc input.file").on("change",function(n){if("undefined"!=typeof this.files[0]){this.files[0];s(this,$(this).siblings("img"))}}),$(".btnc input.file").hover(function(){$(this).next().addClass("hover")},function(){$(this).next().removeClass("hover")}),$(window).on("resize",function(n){t()}),t();var c=new fabric.Canvas("canvas",{preserveObjectStacking:!0,selection:!1,centeredScaling:!0,allowTouchScrolling:!0});$(".canvas").on("touchstart touchmove touchend",function(n){n.preventDefault()}),fabric.Image.fromURL("/assets/background-canvas.png",function(n){c.add(n),c.moveTo(n,9999)},{left:0,top:0,angle:0,opacity:1,lockMovementX:!0,lockMovementY:!0,hasBorders:!1,hasControls:!1,evented:!1,crossOrigin:"anonymous"},{crossOrigin:"Anonymous"}),$(".btnc.change-msj button").on("click",function(o){n()}),n()});